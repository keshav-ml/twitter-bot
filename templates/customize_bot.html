{% extends "base.html" %}

{% block scripts %}
<script type="text/javascript">

	
	
	
	var tot_sub_rows = -1;
	var tot_unsub_rows = -1;
	var tot_tweet = -1;
	function myFunction(imgs) {
	  // Get the expanded image
	  var expandImg = document.getElementById("expandedImg");
	  var tab = document.getElementById("tab");
	  // Get the image text
	  var imgText = document.getElementById("imgtext");
	  // Use the same src in the expanded image as the image being clicked on from the grid
	  expandImg.src = imgs.src;
	  // Use the value of the alt attribute of the clickable image as text inside the expanded image
	  imgText.innerHTML = imgs.alt;
	  // Show the container element (hidden with CSS)
	  expandImg.parentElement.style.display = 'block'
	  expandImg.style.display = "block";
	  tab.style.display = "block";

	}	
	function delete_img(imgs){
	  	var tab = document.getElementById("tab");
		var img = document.getElementById("expandedImg");
		var img_src =  img.src;
		var ask = window.confirm("Are you sure you want to delete this Image?");
		if (ask){
			img.parentElement.style.display = "None";
			tab.style.display = "None";
			img.style.display = 'None';
			window.location = img_src+'/delete';	
		}

		
	}
	function create_row(id_str) {
		var table = document.getElementById(id_str);
		if( id_str == "qna_sub"){
			window.tot_sub_rows += 1		
			var row = table.insertRow(window.tot_sub_rows);
			var cell1 = row.insertCell(0);
		  var cell2 = row.insertCell(1);
		  cell1.innerHTML = "<input type='text' id='"+id_str+"_q"+window.tot_sub_rows+"' placeholder='Enter User query' style='width:100%;'>";
		  cell2.innerHTML = "<input type='text' id='"+id_str+"_a"+window.tot_sub_rows+"' placeholder='Enter bots reply' style='width:100%;'>";
		} else{
			window.tot_unsub_rows += 1
			var row = table.insertRow(window.tot_unsub_rows);
			var cell1 = row.insertCell(0);
		  var cell2 = row.insertCell(1);
		  cell1.innerHTML = "<input type='text' id='"+id_str+"_q"+window.tot_unsub_rows+"' placeholder='Enter User query' style='width:100%;'>";
		  cell2.innerHTML = "<input type='text' id='"+id_str+"_a"+window.tot_unsub_rows+"' placeholder='Enter bots reply' style='width:100%;'>";
		}
	  
	}
	function create_tweet() {
	  window.tot_tweet += 1
	  var table = document.getElementById("tweet");
	  var row = table.insertRow(window.tot_tweet);
	  var cell1 = row.insertCell(0);
	  cell1.innerHTML = "<input type='text' id='t"+window.tot_tweet+"' placeholder='Enter tweet here' style='width:100%;'>";
	  
	  
	}

	function delete_row(id_str) {
	  
	  if( id_str == "qna_sub"){
	  		document.getElementById(id_str).deleteRow(window.tot_sub_rows);
			window.tot_sub_rows -= 1		
		} else{
			document.getElementById(id_str).deleteRow(window.tot_unsub_rows);
			window.tot_unsub_rows -= 1
		}
	}
	function delete_tweet() {
	  document.getElementById("tweet").deleteRow(window.tot_tweet);
	  window.tot_tweet -= 1
	}

	function compile_frm(){
		var que_ans_sub = {};
		var que_ans_unsub = {};
		var tweets = [];
 		for (var i = 0; i <= window.tot_sub_rows; i++) {
			que_ans_sub[document.getElementById('qna_sub_q'+i).value] = document.getElementById('qna_sub_a'+i).value
		}
		for (var i = 0; i <= window.tot_unsub_rows; i++) {
			que_ans_unsub[document.getElementById('qna_unsub_q'+i).value] = document.getElementById('qna_unsub_a'+i).value
		}
		for (var i = 0; i<= window.tot_tweet;i++){
			tweets.push(document.getElementById('t'+i).value)
		}
		document.getElementById("{{form.questions_sub.id}}").value = JSON.stringify(que_ans_sub);
		document.getElementById("{{form.questions_unsub.id}}").value = JSON.stringify(que_ans_unsub);
		document.getElementById("{{form.tweets.id}}").value = JSON.stringify(tweets);
		
	}
</script>

{% endblock %}


{% block content %}
<div class="container-fluid ">
<div style="float: left; width: 100%;" class="container-fluid ">
<form action="" method="post" novalidate enctype="multipart/form-data" onsubmit="compile_frm();">
<div class="py-2" style="float: left; width: 100%;">
    <p class="h2" style="font-size: 30px;">Customize Bot</p>
    	
        {{ form.hidden_tag() }}
        <table cellspacing="10" cellpadding="20">
        	<tr>
        		<td>
        			{{ form.DM_reply_time.label }}
		            <small>(in minutes)</small>
		            {{ form.DM_reply_time() }}
		        </td>
		        <td style="text-align: left;">
		    		{{ form.tweet_time.label }}
            		{{ form.tweet_time() }}    	
		        </td>
        	</tr>
        	<tr>
        		<td style="text-align: left;">
        			{{ form.block_names.label }}<br>
		            <small>(Enter names seperated by space)</small><br>
		            
        		</td>
        		<td style="text-align: left;">
        			{{ form.block_names() }}		
        		</td>
        	</tr>
        	<tr>
        		<td style="text-align: left;">
        			{{ form.sub_names.label }}<br>
		            <small>(Enter names seperated by space)</small><br>
		            
        		</td>
        		<td style="text-align: left;">
        			{{ form.sub_names() }}		
        		</td>
        	</tr>
        	<tr>
        		<td  style="text-align: left;">
        			{{ form.files.label }}
        		</td>
        		<td style="text-align: left;">
					{{ form.files() }}        			
        		</td>
        	</tr>
        </table>
        <p style="display: none;" >
        	{{ form.questions_sub() }}
        </p>
        <p style="display: none;" >
        	{{ form.questions_unsub() }}
        </p>
        <p style="display: none;" >
        	{{ form.tweets() }}
        </p>
    

    </div>
    
    <div style="float: left; height: 100%; width: 100%;" class="py-2">
    	<fieldset>
    	<p class="h2" style="font-size: 30px;">Replies for Subscribed users</p> 
	    	<table id="qna_sub" style="width: 100%;" cellpadding="10px">
			</table>
			
			<div style="height: 25px;" class="text-center">
			<img onclick="delete_row('qna_sub')" src="{{ url_for('static',filename='minus.png') }}" class="img" style="float: right;height: 25px; width: 25px">
			<img onclick="create_row('qna_sub')" src="{{ url_for('static',filename='plus.png') }}" class="img" style="float: right;height: 25px; width: 25px;">

			
			</div>
			
			
		</fieldset>
    </div>
    <div style="float: left; height: 100%; width: 100%;" class="py-2">
    	<fieldset>
    	<p class="h2" style="font-size: 30px;">Replies for Unsubscribed users</p> 
	    	<table id="qna_unsub" style="width: 100%;" cellpadding="10px">
			</table>
			
			<div style="height: 25px;" class="text-center">
			<img onclick="delete_row('qna_unsub')" src="{{ url_for('static',filename='minus.png') }}" class="img" style="float: right;height: 25px; width: 25px">
			<img onclick="create_row('qna_unsub')" src="{{ url_for('static',filename='plus.png') }}" class="img" style="float: right;height: 25px; width: 25px;">

			
			</div>
			
			
		</fieldset>
    </div>
    <div style="float: left; height: 100%; width: 100%;" class="py-2">
    	<fieldset>
    	<p class="h2" style="font-size: 30px;">Enter tweets</p>
	    	<table id="tweet" style="width: 100%;" cellpadding="10px">
			</table>
			
			<div style="height: 25px;" class="text-center">
			<img onclick="delete_tweet()" src="{{ url_for('static',filename='minus.png') }}" class="img" style="float: right; height: 25px; width: 25px;">
			<img onclick="create_tweet()" src="{{ url_for('static',filename='plus.png') }}" class="img" style="float: right;height: 25px; width: 25px;">

			
			</div>
			
			
		</fieldset>
    </div>
    <div style="float: right; margin-top: 50px; margin-bottom: 50px;">
    <button type="Submit" class="btn btn-primary" >Save Settings</button>
    </div>
    </form>
</div>
     <div style="float: left; width: 100%;">
    	<h1 align="center">Uploaded Images</h1>
    	<br>
    	<div class='card'>
    		<div class="row">
    		{% if img_files %}
    			{% for file in img_files %}
    				<div class="column">
					    <img src="{{file}}" alt="{{file.split('/')[-1]}}" onclick="myFunction(this);">
					</div>
    			{% endfor %}
    		{% endif %}
    		</div>


		<!-- The expanding image container -->
		<div class="container">
		  <!-- Close the image -->
		  
		  <div style="background-color: black; text-align: right;" class="dispclass" id="tab">
		  <div id="imgtext" style="text-align: left;float: left; padding: 8px; font-size: 15px;"></div>
		  <span onclick="document.getElementById('expandedImg').style.display='none'; this.parentElement.style.display='none';" style="margin-right: 10px;" class="closebtn">&times;</span>
		  <span onclick="delete_img(this);" style="margin-right: 10px; font-size: 23px; height: 100%;" class="fa closebtn">&#xf014;</span><br>
		  
		  </div>
		  <!-- Expanded image -->
		  <img id="expandedImg" style="width:100%;height: 100%" class="dispclass">

		  
		  
		
		</div>

		</div>
</div>




<div style="float: left; width: 100%;">
    	<h1 align="center">Uploaded Videos</h1>
    	<br>
    	<div class='card'>
    		<div class="row">
    		{% if vid_files %}
    			{% for file in vid_files %}
    				<div class="column">
    					<div style="float: left;"><font>{{file.split('/')[-1]}}</font></div>
					    <div style="float: left;"><video src="{{file}}" alt="{{file.split('/')[-1]}}" controls></div>
					</div>
    			{% endfor %}
    		{% endif %}
    		</div>

		</div>
</div>




</div>
<script type="text/javascript">
    	var qna_sub_field = document.getElementById('{{form.questions_sub.id}}');
    	var qna_unsub_field = document.getElementById('{{form.questions_unsub.id}}');

    	var tweet_field = document.getElementById('{{form.tweets.id}}');
		var table_sub_widget = document.getElementById('qna_sub');
		var table_unsub_widget = document.getElementById('qna_unsub');
		var tweet_table = document.getElementById('tweet')
		if (qna_sub_field.value != ""){
			qna_obj = JSON.parse(qna_sub_field.value)
			for(const key in qna_obj){
				window.tot_sub_rows += 1
				var row = table_sub_widget.insertRow(window.tot_sub_rows);
		  		var cell1 = row.insertCell(0);
		  		var cell2 = row.insertCell(1);
		  		cell1.innerHTML = "<input type='text' id='qna_sub_q"+window.tot_sub_rows+"' value='"+key+"' style='width:100%;'>";
		  		cell2.innerHTML = "<input type='text' id='qna_sub_a"+window.tot_sub_rows+"' value='"+qna_obj[key]+"' style='width:100%;'>";
				
		  		
			}
			
		}
		if (qna_unsub_field.value != ""){
			qna_obj = JSON.parse(qna_unsub_field.value)
			for(const key in qna_obj){
				window.tot_unsub_rows += 1
				var row = table_unsub_widget.insertRow(window.tot_unsub_rows);
		  		var cell1 = row.insertCell(0);
		  		var cell2 = row.insertCell(1);
		  		cell1.innerHTML = "<input type='text' id='qna_unsub_q"+window.tot_unsub_rows+"' value='"+key+"' style='width:100%;'>";
		  		cell2.innerHTML = "<input type='text' id='qna_unsub_a"+window.tot_unsub_rows+"' value='"+qna_obj[key]+"' style='width:100%;'>";
				
		  		
			}
			
		}
		if (tweet_field.value != ""){
			twt_obj = JSON.parse(tweet_field.value)
			for(const key in twt_obj){
				window.tot_tweet += 1
				var row = tweet_table.insertRow(window.tot_tweet);
		  		var cell1 = row.insertCell(0);
		  		
		  		cell1.innerHTML = "<input type='text' id='t"+window.tot_tweet+"' value='"+twt_obj[key]+"' style='width:100%;'>";
		  		
				
		  		
			}
			
		}

    </script>
{% endblock %}